

<!DOCTYPE html>
<html>
<head>
	<title>Home Page</title>
	<script type="text/javascript" src="/static/js/jquery.js"></script>

<style type="text/css">
	.err_msg{color:red;}
	table, th, td 
	{
  		border: 1px solid black;
	}

	table {
	  border-collapse: collapse;
	}
</style>


</head>
<body>

<form onsubmit="event.preventDefault(); return submitForm();">
	Number of Repositories: <input type="number" name="records" value=100 id="form_records">
	<span class="err_msg" id="records_error"></span> <br>


	Date: <input type="date" name="date" id="form_date">
	<span class="err_msg" id="date_error"></span> <br>
	Order: <select name="order" id="form_order">
	  <option value="desc" selected>Descending</option>
	  <option value="asc">Ascending</option>
	</select>	
	<span class="err_msg" id="order"></span> <br><br>
	<input type="submit" value="Submit">
</form>

<hr>
<div id="langs"></div>
<hr>
<div id="repos"></div>




<script type="text/javascript">



let date = new Date(Date.now());
date.setMonth(date.getMonth() - 1);
var currentDate = date.toISOString().substring(0,10);
document.getElementById('form_date').value = currentDate;

function zero_errors(){
	var error_elements = document.getElementsByClassName('err_msg');
	for (var i = error_elements.length - 1; i >= 0; i--) {
		error_elements[i].innerHTML="";
	}
}







function submitForm()
{	
	var form_records = document.getElementById('form_records').value;
	var form_date = document.getElementById('form_date').value;
	var form_order = document.getElementById('form_order').value;
	console.log(form_records, form_date, form_order);
	zero_errors();

	document.getElementById('langs').innerHTML = "Loading, Please Wait ...";
	document.getElementById('repos').innerHTML = "Loading, Please Wait ...";

$.ajax({
  url: "/api/github/search/",
  type: "post", //send it through post method
  data: {
  	"date":form_date,
  	"order":form_order,
  	"records":form_records
  }
})
.done(function(resp){
//console.log(resp);
tableCreate2(resp.data);

})
.catch(function(resp) {
  var errors = resp.responseJSON.data;
  //console.log(errors);
  for (err in errors) {
  //console.log(err);
  //console.log(errors[err][0]);
  document.getElementById(err+"_error").innerHTML = errors[err][0];
}
});
}






function tableCreate(data){
    var body = document.body,
        tbl  = document.createElement('table');
      var tbdy = document.createElement('tbody');

    	var tr = document.createElement('tr');
    	var th_number = document.createElement('th');
    	var th_lang = document.createElement('th');
    	var th_repos = document.createElement('th');
    	
    	th_number.innerHTML = "Number";
    	th_lang.innerHTML = "Language";
    	th_repos.innerHTML = "Number of Repositories";

     	tr.appendChild(th_number);
     	tr.appendChild(th_lang);
     	tr.appendChild(th_repos);
    	tbdy.appendChild(tr);

for (var i = 0; i < data.length; i++) {
    	var tr = document.createElement('tr');
    	var td_num = document.createElement('td');
    	var td_lang = document.createElement('td');
    	var td_repos = document.createElement('td');
    	
    	td_num.innerHTML = i+1;
    	td_lang.innerHTML = data[i].language;
    	td_repos.innerHTML = data[i].length;
    	
    	tr.appendChild(td_num);
    	tr.appendChild(td_lang);
    	tr.appendChild(td_repos);
    	//console.log(data[i]);
    	tbdy.appendChild(tr);
    	tbl.appendChild(tbdy);





     	var h = document.createElement('h1');
     	h.innerHTML  = (i+1)+") "+data[i].language + " ("+data[i].length+")";
    	document.getElementById("repos").appendChild(h);    	
 
      tbl_repo  = document.createElement('table');
    	var tr = document.createElement('tr');
    	var th_number = document.createElement('th');
    	var th_name = document.createElement('th');
    	var th_full_name = document.createElement('th');
    	var th_url = document.createElement('th');
    	var th_lang = document.createElement('th');
    	
    	th_number.innerHTML = "Number";
    	th_name.innerHTML = "Name";
    	th_full_name.innerHTML = "Full name";
    	th_url.innerHTML = "url";
    	th_lang.innerHTML = "Language";

     	tr.appendChild(th_number);
     	tr.appendChild(th_name);
     	tr.appendChild(th_full_name);
     	tr.appendChild(th_url);
     	tr.appendChild(th_lang);
		tbl_repo.appendChild(tr);

    	var repos = data[i].repos;
    	for (var repo = 0; repo < repos.length; repo++) {
    		console.log(repos[repo]);


	    	var tr = document.createElement('tr');
	    	var td_number = document.createElement('td');
	    	var td_name = document.createElement('td');
	    	var td_full_name = document.createElement('td');
	    	var td_url = document.createElement('td');
	    	var td_lang = document.createElement('td');
	    	
	    	td_number.innerHTML = repo+1;
	    	td_name.innerHTML = repos[repo]["name"];
	    	td_full_name.innerHTML = repos[repo]["full_name"];
	    	td_url.innerHTML = repos[repo]["url"];
	    	td_lang.innerHTML = repos[repo]["language"];

	     	tr.appendChild(td_number);
	     	tr.appendChild(td_name);
	     	tr.appendChild(td_full_name);
	     	tr.appendChild(td_url);
	     	tr.appendChild(td_lang);
			tbl_repo.appendChild(tr);

    	}
    	document.getElementById("repos").appendChild(tbl_repo);    	



    }
    //body.appendChild(tbl);
    document.getElementById("langs").innerHTML = tbl.outerHTML;
    //console.log(tbl);
}


function tableCreate2(data)
{
  console.log(data);
  arrangement = 1;
  let repositories_table=`
    <table>
    <tr>
      <th>Number</th> <th>Lang</th> <th>Repos</th>
    </tr>
  `+
  data.map(
    (mydata)=>{console.log(mydata);
    return (`
      <tr>
      <td>${arrangement++}</td>
      <td>${mydata["language"]}</td>
      <td>${mydata["length"]}</td>
      </tr>
    `)}
    ) + 
  `</table>`
  document.getElementById("langs").innerHTML = repositories_table;

}





</script>

</body>
</html>